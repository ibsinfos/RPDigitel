<?phpif (!defined('BASEPATH'))    exit('No direct script access allowed');/** * Login * *   * @package Login * @author Atul * @category CI_Model API */class Contact_model extends CI_Model {    function __construct() {        parent::__construct();        $session_data = $this->session->userdata('user_account');        $this->user_id = $session_data['user_id'];    }    /**     * fetch password     *     * @return array     */    public function getUsersByList($list_id) {        $this->db->select('a.*,(select count(*) from ' . TABLES::$CONTACT_MAPPING . ' as b where a.id=b.contact_id) as optinusers,(select list_name from ' . TABLES::$OPTIN_LIST . ' as c where c.id=' . $list_id . ') as list_name');        $this->db->from(TABLES::$CLIENT_CONTACTS . ' as a ,' . TABLES::$CONTACT_MAPPING . ' as b ,' . TABLES::$OPTIN_LIST . ' as c');        $this->db->where('b.list_id', $list_id);        $this->db->group_by('a.id');        $query = $this->db->get();        $result = $query->result_array();        echo $this->db->last_query();        return $result;    }    public function getUsers($list_id) {        $this->db->select('a.*,b.mapping_id');        $this->db->from(TABLES::$CLIENT_CONTACTS . ' as a ,' . TABLES::$CONTACT_MAPPING . ' as b');        $this->db->where('b.list_id', $list_id);        $this->db->where('b.contact_id = a.id');        $this->db->group_by('a.id');        $query = $this->db->get();        $result = $query->result_array();        return $result;    }    public function getListname($list_id) {        $this->db->select('a.*,(select count(*) from ' . TABLES::$CONTACT_MAPPING . ' as b where a.id=b.contact_id) as optinusers,(select list_name from ' . TABLES::$OPTIN_LIST . ' as c where c.id=' . $list_id . ') as list_name');        $this->db->from(TABLES::$CLIENT_CONTACTS . ' as a ,' . TABLES::$CONTACT_MAPPING . ' as b ,' . TABLES::$OPTIN_LIST . ' as c');        $this->db->where('b.list_id', $list_id);        $this->db->group_by('a.id');        $query = $this->db->get();        $result = $query->result_array();        return $result;    }    public function isUserExistInList($listid, $contactid) {        $this->db->select('mapping_id');        $this->db->from(TABLES::$CONTACT_MAPPING);        $this->db->where('list_id', $listid);        $this->db->where('contact_id', $contactid);        $query = $this->db->get();        $result = $query->result_array();        echo count($result);        if (count($result) > 0) {            return true;        } else {            return false;        }    }    //fetch books    function get_contacts($limit, $start, $st = NULL) {        if ($st == "NULL")            $st = "";        $sql = "select * from " . TABLES::$OPTIN_LIST . " where user_id = " . $this->user_id . " and list_name like '%$st%' limit " . $start . ", " . $limit;        $query = $this->db->query($sql);        return $query->result_array();    }    function get_contact_count($st = NULL) {        if ($st == "NIL")            $st = "";        $sql = "select * from " . TABLES::$OPTIN_LIST . " where user_id = " . $this->user_id . " and list_name like '%$st%'";        $query = $this->db->query($sql);        return $query->num_rows();    }}